Auto WGet Daemon
Great idea and first release (C) 1998 Steve Trubachev
Final release (C) 1998-2003 Dmitry A.Steklenev

СОДЕРЖАНИЕ:
    Краткое описание
    Утилиты загрузки
    Установка
        Важное замечание
    Как это работает
        Как скормить демону нужный URL
        Использование в сети
        Несколько слов о NFTP
    Известные проблемы
    Дополнительные программы
    Подключаемые модули
        Файл задания
    Об авторах
    Специальные спасибы
                 
Краткое описание

    Auto WGet Daemon представляет собой свободно распространяемый набор
    утилит для автоматизации запуска GNU WGet или другой аналогичной утилиты
    загрузки файлов. Если Вам надоело, добравшись до нужной линки в Netscape
    Navigator, копировать ее в буфер обмена и руками запускать WGet (Господи! 
    Какой же Вы ленивый! :), то Auto WGet Daemon - это то, что вам нужно. 
    Auto WGet позволяет запускать загрузку простым Drag'n'Drop URL в 
    специальную папку. Кроме того, Auto WGet поддерживает очередь загрузки и 
    перезапускает недокачанные файлы в том случае, если у Вас отключалось
    электропитание или случилась еще какая нибудь неприятность.

Утилиты загрузки

    На текущий момент поддерживаются две утилиты для загрузки файлов:
    GNU WGet и cURL. Для нормальной работы Auto WGet Daemon необходимо 
    установить одну или обе утилиты и предварительно убедится в их
    работоспособности. Утилиты должны располагаться в любом каталоге,
    описанном в переменной PATH файла CONFIG.SYS.

    Версию GNU WGet для OS/2 можно найти на Hobbes:
    http://http://hobbes.nmsu.edu/ (ищите "wget")

    cURL для OS/2 можно найти на сайте поддержки этой утилиты:
    http://curl.haxx.se

Установка

    Распакуйте архивный файл с дистрибутивом в какой нибудь временный
    каталог и запустите INSTALL.CMD. Отвечайте на вопросы программы
    установки и все должно закончится благополучно :) Инсталлятор создаст
    на Вашем рабочем столе специальную папку "ToDo" и папку "Auto WGet
    Daemon". Кроме того, в %ETC% будет создан (или обновлен, если это уже 
    не первая инсталляция) файл конфигурации AWGET.CFG.

    Объект для запуска демона будет помещен в папку "При загрузке".
    Перезагрузка машины для начала работы не требуется. Демон будет
    запущен сразу после инсталляции.

    Для нормальной работы Auto WGet Daemon должен быть установлен на
    любую файловую систему поддерживающую длинные имена и расширенные
    атрибуты (HPFS, HPFS386, JFS, FAT32).

Важное замечание
    
    Данная версия Auto WGet Daemon может быть установлена поверх версии,
    меньшей чем 1.6.1, но это крайне не рекомендуется. Если вы используете
    такую версию, деинсталлируйте ее, удалите файл %ETC%\AWGET.CFG и
    только после этого инсталлируйте новую версию.

Как это работает

    Демон Auto WGet постоянно сканирует содержимое папки "ToDo" и вложенных
    в нее папок. Как только в этих папках появляется объект с URL, происходит
    старт утилиты загрузки. При этом объект переносится в папку Active, что 
    является признаком запуска процесса загрузки.

    В случае, если процес загрузки был завершен аварийно или произошла
    перезагрузка машины, объекты из папки Active вновь переносятся в
    папку, откуда они были запущены, и обслуживаются в обычном порядке.

Как скормить демону нужный URL

    Способ первый: добравшись до нужной ссылки просто перетащите ее с 
    помощью мыши в папку "ToDo" (или вложенную в нее папку) и она будет 
    поставлена в очередь для загрузки.

    Способ второй: щелкните правой кнопкой по URL в окне бровзера и
    выберите "Copy Link Location". После чего щелкните правой же кнопкой
    мыши по иконке папки или подпапки "ToDo" и выберите "Paste...". Введите
    какое нибудь имя для объекта (хотя это не является обязательным)
    и нажмите "Paste"

    Способ третий: щелкните правой кнопкой по URL в окне бровзера и
    выберите "Copy Link Location". После чего запустите "Add URL" из
    папки "Tools & Utilities" Auto WGet Daemon, скопируйте URL в поле
    ввода, если его еще там нет, (нажав SHIFT-INS или одновременно 
    обе кнопки мыши) и щелкните на "Добавить". По умолчанию объект с 
    указанным URL будет создан в папке "ToDo", но можно выбрать другую
    подпапку с помощью выпадающего списка, расположенного под полем
    ввода.

    Способ четвертый: подготовьте любыми средствами ASCII файл со списком
    URL (например, такой список умеет готовить NFTP) и запустив "Add URL"
    введите в поле ввода путь и имя файла со списком. В папке "ToDo"
    будет создана группа объектов, содержащих URL из указанного списка.

    Способ пятый: установите значение ключа USE_DESKTOP в файле 
    конфигурации в "1" и тогда вы можете помещать URL способами один и два
    прямо на рабочий стол. Демон сам перенесет их в папку "ToDo".

    Способ шестой: установите значение ключа CLIPBOARD_MONITOR в файле
    конфигурации в "1" и делайте все так, как указано в способе третьем.
    За одним исключением: окно для добавления URL появится автоматически
    после копирования URL в буфер обмена.
   
Использование в сети

    Вы можете сделать общедоступной папку "ToDo" и каталог, куда помещаются
    загруженные файлы, и использовать машину с установленным Auto WGet 
    Daemon как общую станцию для загрузки файлов, как из под OS/2 так и из
    под Windows. В этом случае нужно просто перетаскивать URL в эту папку. 

    Можно также организовать отношения клиент-сервер между двумя машинами, 
    работающими под управлением OS/2 и на которых установлен Auto WGet 
    Daemon. Рассмотрим как это делается на примере двух машин, имеющих 
    netbios имена SERVER и CLIENT соответствено. 

    На SERVER нужно создать подпапку с произвольным именем в папке "ToDo".
    В нашем случае мы назовем ее "FromClient". Перетащим в эту папку шаблон 
    дополнительного файла конфигурации awget.cfg (он находится в "Tools & 
    Utilities") и отредактируем его. Нужно снять признак коментария и 
    изменить значение для следующих ключей:

       MESSAGE_DONE  = net send CLIENT "%M: %U"
       MESSAGE_ERROR = net send CLIENT "%M: %U"

    Далее необходимо обеспечить доступ к этой папке на запись и чтение
    со стороны CLIENT. В нашем примере сделаем общедоступным каталог,
    в который установлен Auto WGet Daemon.
    
    Теперь, создадим подпапку "ToServer" в папке "ToDo" на машине CLIENT
    и укажем перенаправление загрузки для этой папки в дополнительном файле 
    конфигурации:

       REDIRECT_TO = \\server\awget\folders\todo\fromclient
    
    Вот и все. Теперь все URL, помещаемые в папку "ToServer" на машине
    CLIENT будут переноситься в папку "FromClient" на SERVER. А 
    сообщения о завершении загрузки будут посылаться SERVER на машину
    CLIENT.

    Нужно заметить, что необязательно создавать специальную папку на CLIENT -
    можно просто поместить файл awget.cfg в папку "ToDo".

Несколько слов о NFTP

    NFTP - это хорошо известный FTP клиент для OS/2, разрабатываемый
    Sergey Ayukov. Найти его можно на http://www.ayukov.com. Для 
    использования Auto WGet Daemon совместно с NFTP, достаточно изменить
    две строчки в nftp.ini (не забудьте убрать символ коментария ";"
    перед этими строками):

       launch-wget = "x:\path_to_awget\awgadd.cmd %s"
       enable-passworded-wget = yes

    где "x:\path_to_awget" нужно заменить на каталог, в котором
    находится Auto WGet Daemon. После этого, вы сможете передавать запрос
    на загрузку демону, отметив нужные файлы и нажав Shift-W.

Конфигурация

    Главный файл конфигурации Auto WGet Daemon находится в каталоге %ETC%, 
    обычно это \MPTN\ETC и называется AWGET.CFG. В папке "Tools & Utilities" 
    есть специальный объект для его редактирования. Описание ключей файла 
    находится в нем самом в виде коментариев, предшествующих каждому ключу.

    Можно создавать папки вложенные в папку "ToDo" и размещать в них
    (в том числе и в самой папке ToDo) дополнительные файлы конфигурации.
    С помощью такого файла можно изменять некоторые параметры описанные
    в главном файле конфигурации (время обслуживания папки, каталог
    для загрузки файлов и другие параметры). Шаблон для создания такого
    файла находится в папке "Tools & Utilities".

    Не забудьте стереть символ коментария "#" перед тем ключем, значение
    которого решите изменить.

Известные проблемы

    - Auto WGet Daemon не понимает объекты с URL, создаваемые Netscape
      Communictor 4.61 под управлением OS/2 Warp 3.0. Используйте
      Netscape Navigator 2.02, Netscape Communicator 4.04 или передавайте
      URL через объект "Add Url". Или используйте OS/2 Warp 4.0 и выше :)
    - Эта программа не совместима с Вадимом Егоровым aka VYX.

Дополнительные программы

    pmpopup2.exe Ulrich Sturmberg PM Popup Version 1.0

    кроме того, вам понадобится netstat из стандартной поставки tcp/ip
    для случая, если необходимо проверять наличие PPP соединения.

Подключаемые модули

    Подключаемые модули - это специальные программы, предназначенные для 
    расширения функциональности Auto WGet Daemon. Поддерживается два вида 
    модулей: общие (global) и частные (private). Общие модули взимодействуют
    непосредственно с демоном и предназначены, в первую очередь, для 
    влияния на процесс планирования заданий. Частные модули взаимодействуют 
    с каждой запускаемым процессом загрузки и могут также влиять на его 
    выполнение.

    Для того чтобы подключить модуль достаточно добавить его описание в 
    главный файл конфигурации AWGET.CFG. Используйте ключ GLOBAL_PLUGIN 
    для общих модулей и PRIVATE_PLUGIN для частных. Например:

    GLOBAL_PLUGIN = Plugins\awpglob.cmd

    Для того чтобы общий модуль был подключен, нужно остановить и вновь
    запустить демона. Частные модули будут подключены при запуске очередного
    процесса загрузки.

    Далее идет информация, предназначеная для разработчиков.

    Подключаемый модуль представляет собой независимый (detach) процесс,
    запускаемый параллельно с демоном (общие модули) или с каждым процессом
    загрузки (частные модули). Взаимодействие с модулем производится через
    стандартные потоки ввода и вывода. Взаимодействие производится построчно,
    с помощью специальных команд. В каждой строке содержится только одна
    команда. После посылки команды модулю, всегда ожидается ответ и 
    выполнение программы приостанавливается до получения ответа. Если в файле 
    конфигурации указано несколько подключаемых модулей, они обслуживаются
    в порядке их описания.

    Команда состоит из ключевого слова длиной в четыре символа и 
    необязательной информационной части. Между командой и информационной
    частью вставляется один пробел.

    Допускается два ответа от информационного модуля: DONE и FAIL. DONE
    означает успешную обработку переданной команды, FAIL означает 
    наличие ошибки или запрет на запрашиваемую операцию. Информация переданная
    вместе с DONE выводится на экран. Информация, сопутствующая FAIL выводится
    в журнал ошибок и на экран.

    Прежде чем ответить DONE или FAIL, модуль может выдать одну или более
    команд с дополнительной информацией: INFO, EVNT, ALRM. Информация
    сопровождающая эти команды выводится на экран. Кроме того информация 
    команды EVNT записывается в журнал событий, а команды ALRM - в журнал 
    ошибок. 

    При работе с общими модулями используются следующие команды:

      INIT домашний_каталог_awget
      Посылается в момент инициализации Auto WGet Daemon. Ответ модуля 
      игнорируется.

      SCAN каталог_todo
      Посылается перед началом сканирования Рабочего стола и папки "ToDo".
      Если хотя бы один модуль ответит FAIL, сканирование будет пропущено.

      CONF файл_конфигурации
      Посылается после обнаружения изменений в основном файле конфигурации.
      Ответ модуля игнорируется.

      SEXE имя_файла_задания
      Посылается перед запуском процесса загрузки. Модуль может изменить
      содержимое файла задания. Если хотя бы один модуль ответит FAIL, 
      запуск будет отложен.
      
      SEND имя_файла_задания
      Посылается после завершения процесса загрузки. Модуль может изменить
      содержимое файла задания. Ответ модуля игнорируется.

      STOP
      Посылается перед завершением работы демона. Демон не ждет ответа
      от модуля, а завершается сразу после посылки команды всем модулям. 

    При работе с частными модулями используются следующие команды:

      INIT имя_файла_задания
      Посылается в момент инициализации процесса загрузки. Модуль может 
      изменить содержимое файла задания. Если хотя бы один модуль ответит 
      FAIL, процесс будет завершен.

      DATA
      Посылается перед началом трансляции вывода утилиты загрузки.
      После ответа DONE, модуль должен переключится в посимвольный
      режим ввода. Трансляция заканчивается нулевым символом '00'x.

      STOP имя_файла_задания
      Посылается перед завершением процесса загрузки. Модуль может 
      изменить содержимое файла задания. Ответ модуля игнорируется.

    Примеры общего и частного подключаемых модулей находятся в каталоге
    "Plugins" Auto WGet Daemon.

Файл задания

    Информация, необходимая процессу загрузки передается с помощью
    файла задания. Формат файла задания подобен формату файла
    конфигурации и состоит из ключей и значений. Используются следующие 
    ключи:

      OBJECT               Имя обрабатываемого объекта, содержащего URL.
      URL                  URL для загрузки.
      DOWNLOAD             Каталог, куда должен быть помещен загружаемый файл.
      MESSAGE_DONE         Команда, выполняемая при нормальном 
                           завершении загрузки.
      MESSAGE_ERROR        Команда, выполняемая при аварийном 
                           завершении загрузки.
      DOWNLOADS_UTILITY    Утилита загрузки.
      DOWNLOADS_PARAMETERS Параметры утилиты загрузки.
      DOWNLOADS_RC         Код завершения утилиты загрузки.
      DOWNLOADS_INFO       Последнее сообщение утилиты загрузки.

    Пример чтения и записи файла задания можно найти в файлах awpglob.cmd
    и awppriv.cmd из каталоге Plugins.

Об авторах

    Гениальная идея принадлежит Степану Трубачеву,
    финальная реализация сделана Дмитрием А.Стекленевым.

    Замечания шлите сюда: glass@ptv.ru

    Auto WGet Daemon является свободным программным обеспечением; Это
    означает что любой имеет право использовать его и распространять его
    при соблюдении определенных условий. Вся работа над этим проектом
    ведется мною в свободное время.

    Поэтому, если вы нашли Auto WGet Daemon полезным для себя и
    заинтересованы в дальнейшем его развитии, пожалуйста, пожертвуйте
    немного денег для поддержания дальнейшей работы.

    Вы можете сделать пожертвование на развитие Auto WGet Daemon на сайте
    BMT Micro:

    https://secure.bmtmicro.com/ECommerce-OffSite/12080000.html

Специальные спасибы

    - Yuri Efimoff <yuri.efimoff@multex.com> за перевод документации и 
      файла сообщений на английский язык.
    - bj <bj@ksib.kemerovo.su> за фрагменты кода для обработки windows 
      shortcuts.
    - Bernd Schemmer, автору сборника "REXX Tips & Triks", откуда я 
      почерпнул немало полезной информации.
    - Vladimir Zabrodsky за его "Album of Algorithms and Techniques for
      Standard Rexx".
    - Guillaume Gay <guillaume.gay@bigfoot.com> за перевод документации и 
      файла сообщений на французский язык.
    - Che-ching Wu <ccwu@pie.com.tw> за перевод документации и 
      файла сообщений на китайский язык.
    - Bernd Giesen <Bernd.Giesen@t-online.de> за перевод документации и 
      файла сообщений на немецкий язык.
    - Jan-Erik Larka <j-erik.p@telia.com> за перевод документации и 
      файла сообщений на шведский язык.
    - Alfredo Fernandez Diaz <alfredo@netropolis-si.com> за перевод 
      документации и файла сообщений на испанский язык.
